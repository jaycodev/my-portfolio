---
import { ClientRouter } from 'astro:transitions'

import { type Language, ui } from '@/i18n'

import '@/globals.css'

import '@fontsource-variable/onest'

interface Props {
  lang: Language
}

const { lang } = Astro.props

if (typeof Astro.locals === 'object') {
  Astro.locals.lang = lang
}
---

<!doctype html>
<html lang={lang} class="dark">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width" />

    <link
      rel="icon"
      type="image/svg+xml"
      href="/icons/favicon-light.svg"
      media="(prefers-color-scheme: light)"
    />
    <link
      rel="icon"
      type="image/svg+xml"
      href="/icons/favicon-dark.svg"
      media="(prefers-color-scheme: dark)"
    />

    <link rel="alternate" hreflang="es" href="https://jaycodev.vercel.app/" />
    <link rel="alternate" hreflang="en" href="https://jaycodev.vercel.app/en" />
    <link rel="alternate" hreflang="x-default" href="https://jaycodev.vercel.app/" />

    <title id="page-title">{ui[lang]['meta.title']}</title>
    <meta id="page-description" name="description" content={ui[lang]['meta.description']} />

    <ClientRouter />
  </head>
  <body class="min-h-screen w-full bg-background">
    <slot />
  </body>
</html>

<script>
  import { ui, type Language } from '@/i18n'

  function updateAllTranslations(lang: Language) {
    const titleElement = document.getElementById('page-title')
    const descriptionElement = document.getElementById('page-description')

    if (titleElement) {
      titleElement.textContent = ui[lang]['meta.title']
    }
    if (descriptionElement) {
      descriptionElement.setAttribute('content', ui[lang]['meta.description'])
    }

    const elements = document.querySelectorAll('[data-i18n]')
    elements.forEach((el) => {
      const key = el.getAttribute('data-i18n')
      if (key && key in ui[lang]) {
        el.textContent = ui[lang][key as keyof (typeof ui)[typeof lang]]
      }
    })
  }

  document.addEventListener('languagechange', ((e: CustomEvent<{ language: Language }>) => {
    updateAllTranslations(e.detail.language)
  }) as EventListener)
</script>
